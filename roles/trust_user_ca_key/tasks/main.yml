---
# tasks file for trust_user_ca_key
- name: copy ssh_ca key 
  become: yes
  copy:
    src: "{{ playbook_dir }}/fetch/ssh_ca/ca_user_key.pub"
    dest: /etc/ssh/
- name: empty old block
  become: yes
  blockinfile:
    path: /etc/ssh/sshd_config
    block: ''
  notify: restart sshd
- name: trust ca_user_key.pub
  become: yes
  blockinfile:
    path: /etc/ssh/sshd_config
    block: |
      TrustedUserCAKeys /etc/ssh/ca_user_key.pub
      Protocol 2    # SSH-2 only, https://access.redhat.com/articles/3022681
    marker: "# {mark} ANSIBLE TrustedUserCAKeys"
  notify: restart sshd
